<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Variable Info</title>
    <style>
        /* Style for the container */
        .container {
            display: flex;
            height: 100vh;
            /* Full viewport height */
        }

        /* Style for the left half */
        .left-half {
            width: 50%;
            background-image: url("normal.png");
            background-repeat: no-repeat;
            background-size: 100%;
            background-position: bottom;
            border-right: 2px solid #ccc;
            /* Vertical line */
            padding: 20px;
            box-sizing: border-box;
            overflow: hidden;
            /* Hide scrollbar */
        }


        /* Style for the right half */
        .right-half {
            width: 50%;
            overflow-y: auto;
            /* Enable vertical scrollbar */
            padding: 20px;
            box-sizing: border-box;
        }

        .form-container {
            display: flex;
            flex-direction: column;
            width: 400px;
            margin: 50px auto;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .form-label {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .form-label label {
            width: 150px;
            margin-right: 10px;
        }

        .form-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 3px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .category-inputs {
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-height: 200px;
            /* Set the maximum height */
            overflow-y: auto;
            /* Enable vertical scrolling */
            background-color: white;
        }

        .category-input {
            display: flex;
            gap: 10px;

        }

        .category-input input[type="number"] {
            width: 50px;
        }

        .category-input input[type="text"] {
            flex: 1;
        }

        .table-container {
            margin-top: 20px;
            padding: 20px;
            border-radius: 5px;
        }

        .table-header {
            font-size: 15.2px;
            margin-bottom: 10px;
        }

        .info-line {
            font-size: 1.1em;
            margin-bottom: 10px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th,
        td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #000000;
        }

        th {
            background-color: #f2f2f2;
        }

        .varName {
            float: right;
        }

        /* Additional styles */
        .scale-selected {
            background-color: #ecec90;
        }

        .ordinal {
            border: 1px solid #ddd;
            background-color: #82d64d;
        }

        .nominal {
            border: 1px solid #ddd;
            background-color: #a3a3a3;
        }

        .multiple-options {
            background-color: #ffc0cb;
        }

        .disabled {
            pointer-events: none;
            opacity: 0.5;
        }
    </style>
</head>

<body>

    <div class="container">
        <!-- Left half with static form -->
        <div class="left-half">
            <form id="variable-form">
                <div class="form-container">
                    <h2>Variable Info</h2>
                    <div class="form-group">
                        <div class="form-label">
                            <label for="current-variable">Variable name:</label>
                            <input type="text" class="form-input" id="current-variable">
                        </div>
                        <div class="form-label">
                            <label for="label">Label:</label>
                            <input type="text" class="form-input" id="label">
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="form-label">
                            <label for="measurement-level">Measurement Level:</label>
                            <select id="measurement-level" class="form-input" onchange="handleMeasurementLevel()">
                                <option value="Nominal">Nominal</option>
                                <option value="Ordinal">Ordinal</option>
                                <option value="Scale">Scale</option>
                            </select>
                        </div>
                        <div class="form-label" id="type-label">
                            <label for="type">Response Type:</label>
                            <select id="type" class="form-input">
                                <option value="single option">single option</option>
                                <option value="multiple options">multiple options</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="form-label">
                            <label for="num-categories">No of Categories:</label>
                            <input type="number" class="form-input" id="num-categories" min="1">
                            <button type="button" onclick="generateCategoryInputs()"
                                style="height:36px;color: white;background-color:black;margin-left: 10px;">Go</button>
                        </div>
                    </div>
                    <div id="category-inputs" class="category-inputs"></div>
                    <button style="color: white; background-color: blue ;" type="button"
                        onclick="saveFormData()">Save</button>
                </div>
            </form>
        </div>

        <!-- Right half (scrollable) -->
        <div class="right-half">
            <button onclick="downloadRightHalf()" style="margin-bottom: 20px;">Download as HTML</button>
            <div id="tables-container"></div>
        </div>

        <script>
            let previousValue = null;

            function generateCategoryInputs() {
                const numCategories = document.getElementById('num-categories').value;
                const categoryInputsContainer = document.getElementById('category-inputs');
                const measurementLevel = document.getElementById('measurement-level').value;
                categoryInputsContainer.innerHTML = '';


                for (let i = 0; i < numCategories; i++) {
                    const div = document.createElement('div');
                    div.className = 'category-input';
                    div.innerHTML = `
            <input type="number" placeholder="Number" ${measurementLevel === 'Scale' ? 'value="N/A" disabled' : ''} oninput="checkSubsequent(this)">
            <input type="text" placeholder="Category" ${measurementLevel === 'Scale' ? 'value="N/A" disabled' : ''}>
        `;
                    categoryInputsContainer.appendChild(div);
                }
            }

            function handleMeasurementLevel() {
                const measurementLevel = document.getElementById('measurement-level').value;
                const typeLabel = document.getElementById('type-label');

                if (measurementLevel === 'Scale' || measurementLevel === 'Ordinal') {
                    typeLabel.classList.add('disabled');
                    document.getElementById('type').value = 'single option';
                    document.getElementById('type').disabled = true;
                } else {
                    typeLabel.classList.remove('disabled');
                    document.getElementById('type').disabled = false;
                }

                // Generate category inputs with "N/A" if the level is Scale
                generateCategoryInputs();
            }

            function checkSubsequent(input) {
                const currentValue = parseInt(input.value);
                if (previousValue !== null && currentValue === previousValue + 1) {
                    const confirmation = confirm("Can I fill the rest of the numbers in the same subsequent manner?");
                    if (confirmation) {
                        fillSubsequentNumbers(input);
                    }
                }
                previousValue = currentValue;
            }

            function fillSubsequentNumbers(startInput) {
                let currentValue = parseInt(startInput.value);
                let currentInput = startInput.nextElementSibling.parentElement.nextElementSibling.querySelector('input[type="number"]');
                while (currentInput) {
                    currentValue++;
                    currentInput.value = currentValue;
                    currentInput = currentInput.parentElement.nextElementSibling ? currentInput.parentElement.nextElementSibling.querySelector('input[type="number"]') : null;
                }
            }


            function saveFormData() {
                const variableName = document.getElementById('current-variable').value;
                const variableLabel = document.getElementById('label').value;
                const measurementLevel = document.getElementById('measurement-level').value;
                let type = document.getElementById('type').value; // Retrieve the response type
                let numCategories = document.getElementById('num-categories').value; // Retrieve the number of categories

                // If the measurement level is 'Scale', set the response type to 'N/A' and number of categories to 'N/A'
                if (measurementLevel === 'Scale') {
                    type = 'N/A';
                    numCategories = 'N/A';
                }

                if (measurementLevel === 'Ordinal') {
                    type = 'N/A';
                }
                console.log("Variable Name:", variableName);
                console.log("Variable Label:", variableLabel);
                console.log("Measurement Level:", measurementLevel);
                console.log("Response Type:", type); // Log the response type to check if it's set to 'N/A'
                console.log("Number of Categories:", numCategories); // Log the number of categories to check if it's set to 'N/A'

                const tablesContainer = document.getElementById('tables-container');

                // Create a new table container
                const tableContainer = document.createElement('div');
                tableContainer.className = 'table-container';
                tablesContainer.appendChild(tableContainer);

                tableContainer.innerHTML = `
    
                <div class="table-header">
        <strong> <span class="varName">${variableName}</span></strong><br>
        <em>Variable Label:</em> <span>${variableLabel}</span><br>
        <span class="info-line">
            <strong>Level of Measurement:</strong> <span>${measurementLevel}</span><br>
            <strong>Response Type:</strong> <span>${type}</span><br>
            <strong>Number of Categories:</strong> <span>${numCategories}</span><br>
        </span>
    </div>
    <table>
        <thead>
            <tr>
                <th>Code</th>
                <th>Category Name</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
    
    `;

                const categoryTableBody = tableContainer.querySelector('tbody');
                const categoryInputs = document.getElementById('category-inputs').querySelectorAll('.category-input');
                categoryInputs.forEach(inputDiv => {
                    let number = inputDiv.querySelector('input[type="number"]').value;
                    let category = inputDiv.querySelector('input[type="text"]').value;

                    // Check if measurement level is Scale, if so, set category to "N/A"
                    if (measurementLevel === 'Scale') {
                        category = 'N/A';
                        number = 'N/A';
                    }

                    const row = document.createElement('tr');
                    row.innerHTML = `<td>${number}</td><td>${category}</td>`;
                    categoryTableBody.appendChild(row);
                });

                // Make the table container visible
                tableContainer.style.display = 'block';

                // Check for measurement level and apply styles accordingly
                if (measurementLevel === 'Scale') {
                    tableContainer.classList.add('scale-selected');
                } else if (measurementLevel === 'Nominal') {
                    tableContainer.classList.add('nominal');
                } else {
                    tableContainer.classList.add('ordinal');
                }

                if (type === 'multiple options') {
                    tableContainer.classList.add('multiple-options');
                }

                // Clear the form inputs
                clearForm();
            }


            function clearForm() {
                document.getElementById('current-variable').value = '';
                document.getElementById('label').value = '';
                document.getElementById('num-categories').value = '';
                document.getElementById('type').value = 'single option';
                document.getElementById('category-inputs').innerHTML = '';
                document.getElementById('measurement-level').value = 'Nominal';
                handleMeasurementLevel();
                previousValue = null;
            }

            function includeStyles() {
                const styles = `
                    <style>
                        .table-container {
                        margin-top: 20px;
                        padding: 20px;
                        border-radius: 5px;
                        width: 446px;
            }

        .table-header {
            font-size: 15.2px;
            margin-bottom: 10px;
        }

        .info-line {
            font-size: 10pt;
            margin-bottom: 10px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th,
        td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #000000;
        }

        th {
            background-color: #f2f2f2;
        }

        .varName {
            float: right;
        }

        /* Additional styles */
        .scale-selected {
            background-color: #ecec90;
        }

        .ordinal {
            border: 1px solid #ddd;
            background-color: #82d64d;
        }

        .nominal {
            border: 1px solid #ddd;
            background-color: #a3a3a3;
        }

        .multiple-options {
            background-color: #ffc0cb;
        }
                

        #tables-container{
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(446px, 1fr)); /* Adjust the column width as needed */
            grid-gap: 20px; /* Adjust the gap between columns as needed */
        }

                    </style>
                `;
                return styles;
            }

            function downloadRightHalf() {
                const rightHalfContent = document.querySelector('.right-half').innerHTML; // Get the outer HTML content of the right half
                const styles = includeStyles(); // Get the styles

                // Combine the right half content with the included styles
                const combinedHTML = `
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>Output</title>
            ${styles}
        </head>
        <body>
            <div class="vars">
            ${rightHalfContent}
            </div>
        </body>
        </html>
    `;

                // Display the right half content
                const rightHalfWindow = window.open('', '_blank');
                rightHalfWindow.document.write(combinedHTML);

                // Create a Blob containing the combined HTML content
                const blob = new Blob([combinedHTML], { type: 'text/html' });

                // Create a link element and trigger a download
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = 'output.html';
                link.click();
            }

        </script>
</body>

</html>